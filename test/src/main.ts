let renderer:PIXI.WebGLRenderer|PIXI.CanvasRenderer;
const stage:PIXI.Container = new PIXI.Container();
let canvas:HTMLCanvasElement;
let stageWidth:number = 0, stageHeight:number = 0;
const mouse:UTILS.Pos = new UTILS.Pos();
const prevMouse:UTILS.Pos = new UTILS.Pos();
const worms:Array<WORMS.Nasty2> = [];
const wormsGraphic:Array<PIXI.Graphics> = [];
const takumusObj:Array<any> = JSON.parse('[{"data":[{"x":87,"y":118},{"x":88.96,"y":117.62},{"x":90.92,"y":117.24},{"x":92.88,"y":116.86},{"x":94.84,"y":116.48},{"x":96.8,"y":116.1},{"x":98.76,"y":115.72},{"x":100.72,"y":115.34},{"x":102.68,"y":114.96},{"x":104.64,"y":114.58},{"x":106.6,"y":114.2},{"x":108.56,"y":113.82},{"x":110.52,"y":113.44},{"x":112.48,"y":113.06},{"x":114.44,"y":112.68},{"x":116.4,"y":112.3},{"x":118.36,"y":111.92},{"x":120.32,"y":111.54},{"x":122.28,"y":111.16},{"x":124.24,"y":110.78},{"x":126.2,"y":110.4},{"x":128.16,"y":110.02},{"x":130.12,"y":109.64},{"x":132.08,"y":109.26},{"x":134.04,"y":108.88},{"x":136,"y":108.5},{"x":137.96,"y":108.12},{"x":139.92,"y":107.74},{"x":141.88,"y":107.36},{"x":143.84,"y":106.98},{"x":145.8,"y":106.6},{"x":147.76,"y":106.22},{"x":149.72,"y":105.84},{"x":151.68,"y":105.46},{"x":153.64,"y":105.08},{"x":155.6,"y":104.7},{"x":157.56,"y":104.32},{"x":159.52,"y":103.94},{"x":161.48,"y":103.56},{"x":163.44,"y":103.18},{"x":165.4,"y":102.8},{"x":167.36,"y":102.42},{"x":169.32,"y":102.04},{"x":171.28,"y":101.66},{"x":173.24,"y":101.28},{"x":175.2,"y":100.9},{"x":177.16,"y":100.52},{"x":179.12,"y":100.14},{"x":181.08,"y":99.76}],"length":49},{"data":[{"x":144,"y":63},{"x":143.68,"y":64.97},{"x":143.36,"y":66.94},{"x":143.04,"y":68.91},{"x":142.74,"y":70.88},{"x":142.44,"y":72.85},{"x":142.14,"y":74.82},{"x":141.84,"y":76.79},{"x":141.54,"y":78.76},{"x":141.24,"y":80.73},{"x":140.94,"y":82.7},{"x":140.64,"y":84.67},{"x":140.34,"y":86.64},{"x":140.04,"y":88.61},{"x":139.74,"y":90.58},{"x":139.44,"y":92.55},{"x":139.14,"y":94.52},{"x":138.84,"y":96.49},{"x":138.51,"y":98.46},{"x":138.17,"y":100.43},{"x":137.8,"y":102.39},{"x":137.42,"y":104.35},{"x":137.02,"y":106.3},{"x":136.61,"y":108.25},{"x":136.19,"y":110.2},{"x":135.77,"y":112.15},{"x":135.36,"y":114.1},{"x":134.95,"y":116.05},{"x":134.54,"y":118},{"x":134.13,"y":119.95},{"x":133.69,"y":121.9},{"x":133.23,"y":123.84},{"x":132.77,"y":125.78},{"x":132.31,"y":127.72},{"x":131.85,"y":129.66},{"x":131.39,"y":131.6},{"x":130.92,"y":133.54},{"x":130.44,"y":135.48},{"x":129.96,"y":137.42},{"x":129.48,"y":139.36},{"x":128.99,"y":141.29},{"x":128.5,"y":143.22},{"x":128.01,"y":145.15},{"x":127.51,"y":147.08},{"x":127,"y":149.01},{"x":126.48,"y":150.94},{"x":125.96,"y":152.87},{"x":125.44,"y":154.8},{"x":124.91,"y":156.72},{"x":124.38,"y":158.64},{"x":123.85,"y":160.56},{"x":123.32,"y":162.48},{"x":122.78,"y":164.4},{"x":122.24,"y":166.32},{"x":121.69,"y":168.24},{"x":121.13,"y":170.16},{"x":120.57,"y":172.08},{"x":120.01,"y":174},{"x":119.44,"y":175.91},{"x":118.87,"y":177.82},{"x":118.29,"y":179.73},{"x":117.71,"y":181.64},{"x":117.13,"y":183.55},{"x":116.55,"y":185.46},{"x":115.97,"y":187.37},{"x":115.39,"y":189.28},{"x":114.8,"y":191.19},{"x":114.21,"y":193.1},{"x":113.62,"y":195.01},{"x":113.03,"y":196.92},{"x":112.44,"y":198.83},{"x":111.85,"y":200.74},{"x":111.25,"y":202.64},{"x":110.62,"y":204.53},{"x":109.99,"y":206.42},{"x":109.36,"y":208.31},{"x":108.73,"y":210.2},{"x":108.1,"y":212.09},{"x":107.46,"y":213.98},{"x":106.82,"y":215.87},{"x":106.18,"y":217.76},{"x":105.54,"y":219.65},{"x":104.9,"y":221.54},{"x":104.25,"y":223.43},{"x":103.6,"y":225.32},{"x":102.93,"y":227.2},{"x":102.25,"y":229.08},{"x":101.57,"y":230.96},{"x":100.89,"y":232.84},{"x":100.21,"y":234.72},{"x":99.53,"y":236.6},{"x":98.85,"y":238.48}],"length":92},{"data":[{"x":176,"y":143},{"x":177.92,"y":142.45},{"x":179.84,"y":141.9},{"x":181.76,"y":141.35},{"x":183.68,"y":140.8},{"x":185.6,"y":140.24},{"x":187.52,"y":139.68},{"x":189.44,"y":139.13},{"x":191.36,"y":138.59},{"x":193.28,"y":138.05},{"x":195.21,"y":137.52},{"x":197.14,"y":137},{"x":199.07,"y":136.5},{"x":201,"y":136},{"x":202.94,"y":135.51},{"x":204.88,"y":135.03},{"x":206.82,"y":134.55},{"x":208.76,"y":134.09},{"x":210.71,"y":133.64},{"x":212.66,"y":133.2},{"x":214.61,"y":132.77},{"x":216.56,"y":132.35},{"x":218.51,"y":131.94},{"x":220.47,"y":131.54},{"x":222.43,"y":131.15},{"x":224.39,"y":130.76},{"x":226.35,"y":130.38},{"x":228.31,"y":130.01},{"x":230.27,"y":129.64},{"x":232.24,"y":129.29},{"x":234.21,"y":128.95},{"x":236.18,"y":128.63},{"x":238.15,"y":128.31},{"x":240.12,"y":127.99},{"x":242.1,"y":127.7},{"x":244.08,"y":127.45}],"length":36},{"data":[{"x":168,"y":204},{"x":169.4,"y":205.42},{"x":170.8,"y":206.84},{"x":172.2,"y":208.26},{"x":173.6,"y":209.68},{"x":175,"y":211.1},{"x":176.4,"y":212.51},{"x":177.81,"y":213.92},{"x":179.23,"y":215.32},{"x":180.67,"y":216.69},{"x":182.13,"y":218.04},{"x":183.62,"y":219.36},{"x":185.13,"y":220.66},{"x":186.67,"y":221.93},{"x":188.23,"y":223.17},{"x":189.83,"y":224.35},{"x":191.46,"y":225.5},{"x":193.1,"y":226.63},{"x":194.75,"y":227.74},{"x":196.44,"y":228.8},{"x":198.14,"y":229.84},{"x":199.85,"y":230.86},{"x":201.57,"y":231.87},{"x":203.3,"y":232.85},{"x":205.05,"y":233.81},{"x":206.8,"y":234.76},{"x":208.56,"y":235.7},{"x":210.33,"y":236.62},{"x":212.11,"y":237.52},{"x":213.9,"y":238.39},{"x":215.7,"y":239.24},{"x":217.53,"y":240.03},{"x":219.37,"y":240.79},{"x":221.23,"y":241.51},{"x":223.1,"y":242.21},{"x":224.98,"y":242.86},{"x":226.88,"y":243.46},{"x":228.79,"y":244.04},{"x":230.7,"y":244.6},{"x":232.62,"y":245.14},{"x":234.55,"y":245.66},{"x":236.48,"y":246.16},{"x":238.41,"y":246.66},{"x":240.34,"y":247.15},{"x":242.27,"y":247.64}],"length":45},{"data":[{"x":440,"y":68},{"x":438.66,"y":69.49},{"x":437.32,"y":70.98},{"x":435.98,"y":72.47},{"x":434.64,"y":73.96},{"x":433.3,"y":75.45},{"x":431.96,"y":76.94},{"x":430.62,"y":78.43},{"x":429.28,"y":79.92},{"x":427.94,"y":81.41},{"x":426.6,"y":82.9},{"x":425.26,"y":84.39},{"x":423.92,"y":85.88},{"x":422.59,"y":87.37},{"x":421.26,"y":88.86},{"x":419.93,"y":90.35},{"x":418.6,"y":91.84},{"x":417.27,"y":93.33},{"x":415.94,"y":94.82},{"x":414.61,"y":96.31},{"x":413.28,"y":97.8},{"x":411.95,"y":99.29},{"x":410.62,"y":100.78},{"x":409.29,"y":102.27},{"x":407.96,"y":103.76},{"x":406.63,"y":105.25},{"x":405.3,"y":106.74},{"x":403.97,"y":108.23},{"x":402.64,"y":109.72},{"x":401.31,"y":111.21},{"x":399.98,"y":112.7},{"x":398.65,"y":114.19},{"x":397.32,"y":115.68},{"x":395.99,"y":117.17},{"x":394.66,"y":118.66},{"x":393.33,"y":120.15},{"x":392,"y":121.64},{"x":390.67,"y":123.13},{"x":389.34,"y":124.62},{"x":388.01,"y":126.11},{"x":386.68,"y":127.6},{"x":385.35,"y":129.09},{"x":384.02,"y":130.58},{"x":382.69,"y":132.07},{"x":381.36,"y":133.56},{"x":380.03,"y":135.05},{"x":378.7,"y":136.54},{"x":377.37,"y":138.03},{"x":376.04,"y":139.52},{"x":374.71,"y":141.01},{"x":373.38,"y":142.5},{"x":372.05,"y":143.99},{"x":370.72,"y":145.48},{"x":369.39,"y":146.97},{"x":368.06,"y":148.46},{"x":366.73,"y":149.95},{"x":365.4,"y":151.44},{"x":364.07,"y":152.93}],"length":58},{"data":[{"x":358,"y":160},{"x":359.41,"y":161.41},{"x":360.82,"y":162.82},{"x":362.23,"y":164.23},{"x":363.64,"y":165.64},{"x":365.05,"y":167.05},{"x":366.46,"y":168.46},{"x":367.87,"y":169.87},{"x":369.28,"y":171.28},{"x":370.69,"y":172.69},{"x":372.1,"y":174.1},{"x":373.51,"y":175.51},{"x":374.92,"y":176.92},{"x":376.33,"y":178.33},{"x":377.74,"y":179.74},{"x":379.15,"y":181.15},{"x":380.56,"y":182.56},{"x":381.97,"y":183.97},{"x":383.38,"y":185.38},{"x":384.79,"y":186.79},{"x":386.2,"y":188.2},{"x":387.61,"y":189.61},{"x":389.02,"y":191.02},{"x":390.43,"y":192.43},{"x":391.84,"y":193.84},{"x":393.25,"y":195.25},{"x":394.66,"y":196.66},{"x":396.07,"y":198.07},{"x":397.48,"y":199.48},{"x":398.89,"y":200.89},{"x":400.29,"y":202.31},{"x":401.69,"y":203.73},{"x":403.08,"y":205.16},{"x":404.47,"y":206.59},{"x":405.86,"y":208.02},{"x":407.24,"y":209.45},{"x":408.63,"y":210.88},{"x":410.01,"y":212.32},{"x":411.39,"y":213.76},{"x":412.77,"y":215.2},{"x":414.14,"y":216.65},{"x":415.5,"y":218.1},{"x":416.85,"y":219.56},{"x":418.19,"y":221.03},{"x":419.53,"y":222.51},{"x":420.86,"y":223.99},{"x":422.18,"y":225.48},{"x":423.49,"y":226.99},{"x":424.79,"y":228.5},{"x":426.07,"y":230.02},{"x":427.35,"y":231.55},{"x":428.61,"y":233.09},{"x":429.86,"y":234.64},{"x":431.11,"y":236.2},{"x":432.35,"y":237.76},{"x":433.58,"y":239.33},{"x":434.81,"y":240.9},{"x":436.02,"y":242.48},{"x":437.22,"y":244.07},{"x":438.42,"y":245.66},{"x":439.62,"y":247.25},{"x":440.82,"y":248.84},{"x":442.02,"y":250.43}],"length":63},{"data":[{"x":449,"y":261},{"x":450.55,"y":259.73},{"x":452.1,"y":258.46},{"x":453.65,"y":257.19},{"x":455.2,"y":255.92},{"x":456.75,"y":254.65},{"x":458.3,"y":253.38},{"x":459.85,"y":252.11}],"length":8},{"data":[{"x":505,"y":336},{"x":505.8,"y":337.82},{"x":506.6,"y":339.64},{"x":507.4,"y":341.46},{"x":508.2,"y":343.28},{"x":509,"y":345.1},{"x":509.8,"y":346.92},{"x":510.6,"y":348.74},{"x":511.4,"y":350.56},{"x":512.2,"y":352.38},{"x":513,"y":354.2}],"length":11},{"data":[{"x":569,"y":132},{"x":570.94,"y":131.55},{"x":572.88,"y":131.1},{"x":574.82,"y":130.63},{"x":576.76,"y":130.14},{"x":578.7,"y":129.65},{"x":580.64,"y":129.16},{"x":582.58,"y":128.67},{"x":584.52,"y":128.18},{"x":586.46,"y":127.7},{"x":588.4,"y":127.23},{"x":590.34,"y":126.76},{"x":592.28,"y":126.29},{"x":594.22,"y":125.82},{"x":596.16,"y":125.36},{"x":598.1,"y":124.9},{"x":600.04,"y":124.44},{"x":601.98,"y":123.98},{"x":603.93,"y":123.53},{"x":605.88,"y":123.09},{"x":607.83,"y":122.66},{"x":609.78,"y":122.23},{"x":611.73,"y":121.81},{"x":613.68,"y":121.39},{"x":615.63,"y":120.98},{"x":617.58,"y":120.58},{"x":619.53,"y":120.18},{"x":621.49,"y":119.78},{"x":623.45,"y":119.38},{"x":625.41,"y":118.98},{"x":627.37,"y":118.59},{"x":629.33,"y":118.21},{"x":631.29,"y":117.84},{"x":633.25,"y":117.47},{"x":635.21,"y":117.1},{"x":637.17,"y":116.74},{"x":639.13,"y":116.39},{"x":641.1,"y":116.05},{"x":643.07,"y":115.72},{"x":645.04,"y":115.41},{"x":647.01,"y":115.11},{"x":648.99,"y":114.83},{"x":650.97,"y":114.56},{"x":652.95,"y":114.31}],"length":44},{"data":[{"x":617,"y":67},{"x":616.97,"y":68.99},{"x":616.94,"y":70.98},{"x":616.91,"y":72.97},{"x":616.88,"y":74.96},{"x":616.85,"y":76.95},{"x":616.82,"y":78.94},{"x":616.79,"y":80.93},{"x":616.76,"y":82.92},{"x":616.73,"y":84.91},{"x":616.7,"y":86.9},{"x":616.67,"y":88.89},{"x":616.64,"y":90.88},{"x":616.61,"y":92.87},{"x":616.58,"y":94.86},{"x":616.55,"y":96.85},{"x":616.52,"y":98.84},{"x":616.49,"y":100.83},{"x":616.46,"y":102.82},{"x":616.43,"y":104.81},{"x":616.4,"y":106.8},{"x":616.37,"y":108.79},{"x":616.34,"y":110.78},{"x":616.31,"y":112.77},{"x":616.28,"y":114.76},{"x":616.25,"y":116.75},{"x":616.22,"y":118.74},{"x":616.19,"y":120.73},{"x":616.16,"y":122.72},{"x":616.13,"y":124.71},{"x":616.1,"y":126.7},{"x":616.07,"y":128.69},{"x":616.04,"y":130.68},{"x":616.01,"y":132.67},{"x":615.98,"y":134.66},{"x":615.95,"y":136.65},{"x":615.92,"y":138.64},{"x":615.89,"y":140.63},{"x":615.86,"y":142.62},{"x":615.83,"y":144.61},{"x":615.8,"y":146.6},{"x":615.77,"y":148.59},{"x":615.74,"y":150.58},{"x":615.71,"y":152.57},{"x":615.68,"y":154.56},{"x":615.65,"y":156.55},{"x":615.62,"y":158.54},{"x":615.59,"y":160.53},{"x":615.56,"y":162.52},{"x":615.53,"y":164.51},{"x":615.5,"y":166.5},{"x":615.47,"y":168.49},{"x":615.44,"y":170.48},{"x":615.41,"y":172.47},{"x":615.38,"y":174.46},{"x":615.35,"y":176.45},{"x":615.32,"y":178.44},{"x":615.29,"y":180.43},{"x":615.26,"y":182.42},{"x":615.23,"y":184.41},{"x":615.2,"y":186.4},{"x":615.17,"y":188.39},{"x":615.14,"y":190.38},{"x":615.11,"y":192.37},{"x":615.08,"y":194.36},{"x":615.05,"y":196.35},{"x":615.02,"y":198.34},{"x":614.9,"y":200.33},{"x":614.78,"y":202.32},{"x":614.66,"y":204.31},{"x":614.53,"y":206.3},{"x":614.34,"y":208.29},{"x":614.08,"y":210.27},{"x":613.81,"y":212.25},{"x":613.37,"y":214.2},{"x":612.84,"y":216.12},{"x":612.15,"y":217.99},{"x":611.32,"y":219.81},{"x":610.48,"y":221.62},{"x":609.51,"y":223.37},{"x":608.52,"y":225.11},{"x":607.15,"y":226.57},{"x":605.48,"y":227.68},{"x":603.6,"y":228.37},{"x":601.66,"y":228.88},{"x":599.66,"y":229.04},{"x":597.66,"y":228.87},{"x":595.71,"y":228.39},{"x":593.89,"y":227.54},{"x":592.13,"y":226.57},{"x":590.42,"y":225.51},{"x":588.77,"y":224.37},{"x":587.28,"y":223.02},{"x":585.97,"y":221.5},{"x":584.76,"y":219.9},{"x":583.8,"y":218.14},{"x":582.96,"y":216.32},{"x":582.25,"y":214.44},{"x":581.65,"y":212.53},{"x":581.11,"y":210.6},{"x":580.78,"y":208.62},{"x":580.66,"y":206.62},{"x":580.58,"y":204.62},{"x":580.58,"y":202.62},{"x":580.68,"y":200.62},{"x":580.87,"y":198.62},{"x":581.08,"y":196.63},{"x":581.31,"y":194.64},{"x":581.6,"y":192.66},{"x":581.97,"y":190.69},{"x":582.34,"y":188.72},{"x":582.84,"y":186.78},{"x":583.61,"y":184.93},{"x":584.76,"y":183.29},{"x":586.06,"y":181.77},{"x":587.43,"y":180.31},{"x":589.13,"y":179.27},{"x":590.97,"y":178.49},{"x":592.92,"y":178.05},{"x":594.91,"y":178.18},{"x":596.86,"y":178.62},{"x":598.69,"y":179.42},{"x":600.35,"y":180.53},{"x":601.91,"y":181.77},{"x":603.39,"y":183.11},{"x":604.76,"y":184.55},{"x":606.04,"y":186.08},{"x":607.16,"y":187.73},{"x":608.16,"y":189.46},{"x":609.14,"y":191.19},{"x":610.04,"y":192.97},{"x":610.83,"y":194.8},{"x":611.46,"y":196.69},{"x":611.97,"y":198.62},{"x":612.43,"y":200.56},{"x":612.83,"y":202.51},{"x":613.16,"y":204.48},{"x":613.46,"y":206.45},{"x":613.75,"y":208.42},{"x":614.03,"y":210.39},{"x":614.29,"y":212.37},{"x":614.51,"y":214.35},{"x":614.71,"y":216.33},{"x":614.89,"y":218.32},{"x":615.07,"y":220.31},{"x":615.31,"y":222.29},{"x":615.65,"y":224.25},{"x":616.01,"y":226.21},{"x":616.44,"y":228.16},{"x":617.05,"y":230.06},{"x":617.87,"y":231.88},{"x":618.92,"y":233.57},{"x":620.17,"y":235.12},{"x":621.76,"y":236.32},{"x":623.45,"y":237.38},{"x":625.22,"y":238.3},{"x":627.03,"y":239.13},{"x":628.9,"y":239.81},{"x":630.83,"y":240.32},{"x":632.78,"y":240.73},{"x":634.75,"y":241.02},{"x":636.73,"y":241.22},{"x":638.72,"y":241.37},{"x":640.71,"y":241.5},{"x":642.7,"y":241.6},{"x":644.69,"y":241.69},{"x":646.68,"y":241.75},{"x":648.67,"y":241.81},{"x":650.66,"y":241.87},{"x":652.65,"y":241.91},{"x":654.64,"y":241.91},{"x":656.63,"y":241.88},{"x":658.62,"y":241.81},{"x":660.61,"y":241.71},{"x":662.6,"y":241.57},{"x":664.59,"y":241.4},{"x":666.57,"y":241.18},{"x":668.55,"y":240.93},{"x":670.53,"y":240.64},{"x":672.49,"y":240.29},{"x":674.45,"y":239.91},{"x":676.41,"y":239.51},{"x":678.36,"y":239.09},{"x":680.31,"y":238.66},{"x":682.26,"y":238.21},{"x":684.2,"y":237.74},{"x":686.13,"y":237.22},{"x":688.04,"y":236.62},{"x":689.93,"y":235.97},{"x":691.72,"y":235.09},{"x":693.48,"y":234.14},{"x":695.23,"y":233.18},{"x":696.98,"y":232.22},{"x":698.7,"y":231.19},{"x":700.39,"y":230.12},{"x":701.91,"y":228.82},{"x":703.17,"y":227.27},{"x":704.26,"y":225.59},{"x":705.14,"y":223.79},{"x":705.87,"y":221.93},{"x":706.5,"y":220.03},{"x":707,"y":218.09},{"x":707.38,"y":216.12},{"x":707.64,"y":214.13},{"x":707.85,"y":212.14},{"x":708.01,"y":210.14},{"x":708.16,"y":208.14},{"x":708.31,"y":206.14},{"x":708.46,"y":204.14},{"x":708.61,"y":202.14},{"x":708.76,"y":200.14},{"x":708.91,"y":198.14},{"x":709.06,"y":196.14},{"x":709.19,"y":194.14},{"x":709.32,"y":192.14},{"x":709.45,"y":190.14},{"x":709.58,"y":188.14},{"x":709.71,"y":186.14},{"x":709.84,"y":184.14},{"x":709.98,"y":182.14},{"x":710.12,"y":180.14},{"x":710.26,"y":178.14},{"x":710.4,"y":176.14},{"x":710.54,"y":174.14},{"x":710.68,"y":172.14},{"x":710.82,"y":170.14},{"x":710.96,"y":168.14}],"length":227},{"data":[{"x":708,"y":94},{"x":709.48,"y":95.33},{"x":710.96,"y":96.66},{"x":712.46,"y":97.97},{"x":713.98,"y":99.26},{"x":715.49,"y":100.56},{"x":716.98,"y":101.89},{"x":718.46,"y":103.23},{"x":719.92,"y":104.59},{"x":721.35,"y":105.98},{"x":722.78,"y":107.37},{"x":724.21,"y":108.76},{"x":725.62,"y":110.17},{"x":727.01,"y":111.59},{"x":728.39,"y":113.03},{"x":729.74,"y":114.5},{"x":731.04,"y":116.01},{"x":732.32,"y":117.54},{"x":733.55,"y":119.11},{"x":734.74,"y":120.71},{"x":735.92,"y":122.32},{"x":737.08,"y":123.94},{"x":738.22,"y":125.57},{"x":739.33,"y":127.22},{"x":740.42,"y":128.89},{"x":741.49,"y":130.57},{"x":742.53,"y":132.27}],"length":27},{"data":[{"x":805,"y":118},{"x":806.98,"y":117.75},{"x":808.96,"y":117.5},{"x":810.94,"y":117.25},{"x":812.92,"y":117},{"x":814.9,"y":116.73},{"x":816.87,"y":116.44},{"x":818.84,"y":116.14},{"x":820.81,"y":115.85},{"x":822.78,"y":115.54},{"x":824.75,"y":115.22},{"x":826.72,"y":114.91},{"x":828.69,"y":114.6},{"x":830.66,"y":114.29},{"x":832.63,"y":113.98},{"x":834.6,"y":113.67},{"x":836.57,"y":113.36},{"x":838.54,"y":113.05},{"x":840.51,"y":112.74},{"x":842.48,"y":112.43},{"x":844.45,"y":112.11},{"x":846.42,"y":111.79},{"x":848.39,"y":111.48},{"x":850.36,"y":111.16},{"x":852.33,"y":110.84},{"x":854.3,"y":110.51},{"x":856.27,"y":110.18},{"x":858.24,"y":109.86},{"x":860.21,"y":109.55},{"x":862.18,"y":109.24},{"x":864.15,"y":108.93},{"x":866.12,"y":108.63},{"x":868.1,"y":108.35},{"x":870.08,"y":108.07},{"x":872.06,"y":107.8},{"x":874.04,"y":107.54},{"x":876.02,"y":107.29},{"x":878,"y":107.04},{"x":879.98,"y":106.79},{"x":881.96,"y":106.54},{"x":883.94,"y":106.29},{"x":885.92,"y":106.04},{"x":887.9,"y":105.79},{"x":889.88,"y":105.54},{"x":891.86,"y":105.29},{"x":893.84,"y":105.04},{"x":895.82,"y":104.8},{"x":897.8,"y":104.56},{"x":899.78,"y":104.33},{"x":901.76,"y":104.12},{"x":903.74,"y":103.91},{"x":905.72,"y":103.7},{"x":907.7,"y":103.49},{"x":909.68,"y":103.28},{"x":911.66,"y":103.07},{"x":913.65,"y":102.87},{"x":915.64,"y":102.68},{"x":917.63,"y":102.5},{"x":919.62,"y":102.32},{"x":921.61,"y":102.14},{"x":923.6,"y":101.97},{"x":925.59,"y":101.8},{"x":927.58,"y":101.63},{"x":929.57,"y":101.46},{"x":931.56,"y":101.3},{"x":933.55,"y":101.14},{"x":935.54,"y":100.99},{"x":937.53,"y":100.84},{"x":939.52,"y":100.69},{"x":941.51,"y":100.54},{"x":943.5,"y":100.41},{"x":945.49,"y":100.28},{"x":947.48,"y":100.15},{"x":949.47,"y":100.02},{"x":951.46,"y":99.89},{"x":953.45,"y":99.76},{"x":955.44,"y":99.63},{"x":957.43,"y":99.51},{"x":959.42,"y":99.39},{"x":961.41,"y":99.27},{"x":963.4,"y":99.15},{"x":965.39,"y":99.03},{"x":967.38,"y":98.92},{"x":969.37,"y":98.82},{"x":971.36,"y":98.72},{"x":973.35,"y":98.62},{"x":975.34,"y":98.52}],"length":87},{"data":[{"x":908,"y":60},{"x":908.08,"y":61.99},{"x":908.16,"y":63.98},{"x":908.24,"y":65.97},{"x":908.32,"y":67.96},{"x":908.4,"y":69.95},{"x":908.48,"y":71.94},{"x":908.56,"y":73.93},{"x":908.64,"y":75.92},{"x":908.72,"y":77.91},{"x":908.8,"y":79.9},{"x":908.88,"y":81.89},{"x":908.96,"y":83.88},{"x":909.04,"y":85.87},{"x":909.12,"y":87.86},{"x":909.2,"y":89.85},{"x":909.28,"y":91.84},{"x":909.36,"y":93.83},{"x":909.44,"y":95.82},{"x":909.53,"y":97.81},{"x":909.62,"y":99.8},{"x":909.71,"y":101.79},{"x":909.8,"y":103.78},{"x":909.89,"y":105.77},{"x":909.98,"y":107.76},{"x":910.06,"y":109.75},{"x":910.14,"y":111.74},{"x":910.22,"y":113.73},{"x":910.3,"y":115.72},{"x":910.38,"y":117.71},{"x":910.46,"y":119.7},{"x":910.54,"y":121.69},{"x":910.62,"y":123.68},{"x":910.7,"y":125.67},{"x":910.78,"y":127.66},{"x":910.86,"y":129.65},{"x":910.94,"y":131.64},{"x":911.03,"y":133.63},{"x":911.12,"y":135.62},{"x":911.21,"y":137.61},{"x":911.3,"y":139.6},{"x":911.39,"y":141.59},{"x":911.48,"y":143.58},{"x":911.57,"y":145.57},{"x":911.69,"y":147.56},{"x":911.82,"y":149.55},{"x":911.95,"y":151.54},{"x":912.09,"y":153.53},{"x":912.25,"y":155.52},{"x":912.41,"y":157.51},{"x":912.57,"y":159.5},{"x":912.73,"y":161.49},{"x":912.88,"y":163.48},{"x":913.02,"y":165.47},{"x":913.15,"y":167.46},{"x":912.98,"y":169.45},{"x":912.85,"y":171.44},{"x":912.6,"y":173.42},{"x":912.28,"y":175.39},{"x":911.89,"y":177.35},{"x":911.41,"y":179.29},{"x":910.59,"y":181.11},{"x":909.52,"y":182.8},{"x":908.33,"y":184.41},{"x":906.96,"y":185.87},{"x":905.42,"y":187.14},{"x":903.68,"y":188.13},{"x":901.78,"y":188.75},{"x":899.85,"y":189.3},{"x":897.91,"y":189.81},{"x":895.95,"y":190.22},{"x":893.95,"y":190.19},{"x":891.97,"y":189.9},{"x":890.03,"y":189.38},{"x":888.11,"y":188.8},{"x":886.21,"y":188.16},{"x":884.33,"y":187.45},{"x":882.51,"y":186.62},{"x":880.82,"y":185.54},{"x":879.33,"y":184.2},{"x":878.03,"y":182.67},{"x":876.86,"y":181.04},{"x":875.83,"y":179.32},{"x":874.99,"y":177.5},{"x":874.3,"y":175.62},{"x":873.75,"y":173.69},{"x":873.39,"y":171.72},{"x":873.09,"y":169.74},{"x":872.88,"y":167.75},{"x":872.77,"y":165.75},{"x":872.71,"y":163.75},{"x":872.71,"y":161.75},{"x":872.77,"y":159.75},{"x":872.92,"y":157.75},{"x":873.15,"y":155.76},{"x":873.55,"y":153.8},{"x":874.08,"y":151.87},{"x":874.73,"y":149.98},{"x":875.49,"y":148.13},{"x":876.34,"y":146.32},{"x":877.34,"y":144.59},{"x":878.44,"y":142.92},{"x":879.69,"y":141.36},{"x":881.1,"y":139.94},{"x":882.63,"y":138.65},{"x":884.33,"y":137.59},{"x":886.11,"y":136.69},{"x":887.98,"y":136},{"x":889.95,"y":135.66},{"x":891.94,"y":135.64},{"x":893.91,"y":135.95},{"x":895.83,"y":136.49},{"x":897.64,"y":137.33},{"x":899.4,"y":138.27},{"x":901.1,"y":139.32},{"x":902.7,"y":140.51},{"x":904.11,"y":141.92},{"x":905.32,"y":143.51},{"x":906.45,"y":145.15},{"x":907.56,"y":146.81},{"x":908.6,"y":148.51},{"x":909.53,"y":150.28},{"x":910.28,"y":152.13},{"x":910.91,"y":154.02},{"x":911.47,"y":155.93},{"x":911.91,"y":157.88},{"x":912.3,"y":159.84},{"x":912.48,"y":161.83},{"x":912.56,"y":163.82},{"x":912.62,"y":165.81},{"x":912.64,"y":167.8},{"x":912.64,"y":169.79},{"x":912.6,"y":171.78},{"x":912.53,"y":173.77},{"x":912.37,"y":175.76},{"x":912.19,"y":177.75},{"x":912,"y":179.74},{"x":911.73,"y":181.72},{"x":911.41,"y":183.69},{"x":911.03,"y":185.65},{"x":910.62,"y":187.6},{"x":910.2,"y":189.55},{"x":909.74,"y":191.49},{"x":909.19,"y":193.41},{"x":908.5,"y":195.28},{"x":907.76,"y":197.13},{"x":906.96,"y":198.96},{"x":906.16,"y":200.79},{"x":905.37,"y":202.62},{"x":904.58,"y":204.45},{"x":903.77,"y":206.28},{"x":902.94,"y":208.1},{"x":902.1,"y":209.91},{"x":901.24,"y":211.71},{"x":900.38,"y":213.51},{"x":899.52,"y":215.31},{"x":898.64,"y":217.1},{"x":897.74,"y":218.88},{"x":896.82,"y":220.65},{"x":895.87,"y":222.41},{"x":894.87,"y":224.14},{"x":893.83,"y":225.85},{"x":892.77,"y":227.54},{"x":891.67,"y":229.21},{"x":890.54,"y":230.86},{"x":889.39,"y":232.5},{"x":888.22,"y":234.12},{"x":886.99,"y":235.69},{"x":885.73,"y":237.24},{"x":884.45,"y":238.77},{"x":883.14,"y":240.28},{"x":881.82,"y":241.78},{"x":880.47,"y":243.26},{"x":879.11,"y":244.72},{"x":877.73,"y":246.17},{"x":876.33,"y":247.59},{"x":874.91,"y":249},{"x":873.46,"y":250.38},{"x":872.01,"y":251.76},{"x":870.55,"y":253.12},{"x":869.07,"y":254.47},{"x":867.59,"y":255.82},{"x":866.1,"y":257.15},{"x":864.59,"y":258.46},{"x":863.08,"y":259.77}],"length":185}]');
const takumuses:Array<ROUTES.Line> = [];
let pressing = false;
const init = ()=> {
	takumusObj.forEach((s)=>{
		const line = new ROUTES.Line();
		(<Array<any>>s.data).forEach((p)=>{
			line.push(new UTILS.Pos(p.x, p.y));
		});
		takumuses.push(line);
	});
	//window.devicePixelRatio;
	renderer = PIXI.autoDetectRenderer(800, 800, {antialias: true, resolution:2, transparent:false});
	canvas = <HTMLCanvasElement>document.getElementById("content");
	canvas.appendChild(renderer.view);
	renderer.view.style.width = "100%";
	renderer.view.style.height = "100%";
	window.addEventListener("resize", resize);
	window.addEventListener('resize', resize);
	window.addEventListener('orientationchange', resize);
	window.addEventListener("mousemove", (e)=>{
		move(e.clientX, e.clientY);
	});
	window.addEventListener("mousedown", (e)=>{
		begin(e.clientX, e.clientY);
	});
	window.addEventListener("mouseup", ()=>{
		end();
	});
	window.addEventListener("touchmove", (e:TouchEvent)=>{
		move(e.touches[0].clientX, e.touches[0].clientY)
	});
	window.addEventListener("touchstart", (e:TouchEvent)=>{
		begin(e.touches[0].clientX, e.touches[0].clientY);
	});
	window.addEventListener("touchend", (e:TouchEvent)=>{
		end();
	});
	const begin = (x:number, y:number)=>{
		pressing = true;
		prevMouse.x = mouse.x = x;
		prevMouse.y = mouse.y = y;
		const c = 0xffffff*Math.random()
		for(let i = 0; i < worms.length; i ++){
			worms[i].setColor(i==0?0xffffff*Math.random():0x000000, i==0?0x000000:c);
		}
	}
	const move = (x:number, y:number)=>{
		const dx = prevMouse.x - mouse.x;
		const dy = prevMouse.y - mouse.y;
		if(dx*dx + dy*dy > 2000){
			prevMouse.x = mouse.x;
			prevMouse.y = mouse.y;
		}
		mouse.x = x;
		mouse.y = y;
	}
	const end = ()=>{
		pressing = false;
	}
	const c = 0xffffff*Math.random();
	for(let i = 0; i < 16; i ++){
		const w = new WORMS.Nasty2(
			30,
			{
				headLength:10,
				tailLength:20,
				thickness:i==0?20:15
			},
			i==0?0xffffff*Math.random():0x000000,
			i==0?0x000000:0xffffff*Math.random()
		);
		worms.push(w);
		stage.addChild(w);
		w.blendMode = PIXI.BLEND_MODES.ADD;
		w.setStep(1);
		const g = new PIXI.Graphics();
		wormsGraphic.push(g);
	}
	wormsGraphic.forEach((g)=>{
		stage.addChild(g);
	})
	stage.addChild(new PIXI.Text("タッチ中はついてくる。", {fill:0xffffff, fontSize:60}));
	draw();
	resize();
}
let wave:number = 0.12;
const draw = ()=> {
	requestAnimationFrame(draw);
	const target = mouse;
	const mouseRadian = Math.atan2(target.y - prevMouse.y, target.x - prevMouse.x);
	for(let i = 0; i < worms.length; i ++){
		const w = worms[i];
		const g = wormsGraphic[i];
		if(w.getStep() == 1 || pressing && !w.getRoute().tail().equals(target)){
			
			let pos:UTILS.VecPos;
			if(i!=0){
				pos = worms[0].getTailVecPos().clone();
				pos.pos.x += Math.random()*200-100;
				pos.pos.y += Math.random()*200-100;
				pos.add(Math.PI);
			}else{
				const p = 0.5;
				pos = new UTILS.VecPos(
					pressing?target.x:stageWidth*(1-p)/2 + stageWidth*p*Math.random(),
					pressing?target.y:stageHeight*(1-p)/2 + stageHeight*p*Math.random(),
					Math.PI*2*Math.random()
				);
			}
			//w.reverse();
			const r = ROUTES.RouteGenerator.getMinimumRoute(
				w.getHeadVecPos(),
				pos,
				i==0?200:50*Math.random()+100,
				i==0?200:50*Math.random()+100,
				5
			);
			//r.pop();
			
			r.wave(16, wave, true);
			w.addRouteFromCurrent(r);
			w.setStep(0);

			///*
			g.clear();
			const L = r.getLength();
			const h = r.head();
			const t = r.tail();
			const gc = 0xffffff*Math.random();
			g.lineStyle(1, gc, 0.5);
			g.drawCircle(h.x, h.y, 10);
			g.drawCircle(t.x, t.y, 10);
			g.moveTo(h.x, h.y);
			for(let n = 1; n < L; n ++){
				const p = r.at(n);
				g.lineTo(p.x, p.y);
			}
			//*/
		}
		w.addStep(i!=0?2:1.5);
		const add = Math.sin(w.getHeadVecPos().r)*2;
		//w.addStep(add > 0?add:0);
		w.render();
	}
	TWEEN.update();
	renderer.render(stage);

	//stage.x = -w.getCurrentLine().getTailVecPos().pos.x + stageWidth/2;
	//stage.y = -w.getCurrentLine().getTailVecPos().pos.y + stageHeight/2;
}
window["setWave"] = (w:number) => {
	wave = w;
}
const resize = () => {
	const width:number = canvas.offsetWidth;
	const height:number = canvas.offsetHeight;
	stageWidth = width;
	stageHeight = height;
	renderer.resize(width, height);
}
window.onload = init;
//100コミット
console.log("call function 'setWave(freq)' to set wave frequency.");